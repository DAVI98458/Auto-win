-- Carrega Rayfield
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

-- Serviços
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- Variáveis globais
getgenv().AimbotAtivado = false
getgenv().ESPAtivado = false
getgenv().TeamCheck = false
getgenv().DeadCheck = false
getgenv().WallCheck = false
getgenv().NoclipAtivado = false
getgenv().InfJumpAtivado = false

-- Interface principal
local Window = Rayfield:CreateWindow({
	Name = "Red Light, Green Light and Glass Bridge",
	LoadingTitle = "Carregando...",
	LoadingSubtitle = "By @shadown_gd",
	ConfigurationSaving = { Enabled = false },
	KeySystem = false,
})

-- Função Teleporte
local function teleportTo(pos)
	local char = LocalPlayer.Character
	if char and char:FindFirstChild("HumanoidRootPart") then
		char.HumanoidRootPart.CFrame = CFrame.new(pos)
	end
end

-- ESP Functions
local function removeAllESP()
	for _, player in pairs(Players:GetPlayers()) do
		if player.Character then
			local espTag = player.Character:FindFirstChild("ESPName")
			if espTag then espTag:Destroy() end
		end
	end
end

local function createESP(player)
	if player.Character and player.Character:FindFirstChild("Head") then
		if player.Character:FindFirstChild("ESPName") then return end

		local tag = Instance.new("BillboardGui")
		tag.Name = "ESPName"
		tag.Adornee = player.Character.Head
		tag.AlwaysOnTop = true
		tag.Size = UDim2.new(0, 100, 0, 40)
		tag.Parent = player.Character

		local textLabel = Instance.new("TextLabel", tag)
		textLabel.BackgroundTransparency = 1
		textLabel.Size = UDim2.new(1,0,1,0)
		textLabel.Font = Enum.Font.SourceSans
		textLabel.Text = player.Name
		textLabel.TextColor3 = (player.Team ~= LocalPlayer.Team) and Color3.fromRGB(255,0,0) or Color3.fromRGB(0,0,255)
		textLabel.TextSize = 11
		textLabel.TextScaled = false
		textLabel.TextStrokeTransparency = 0.75
		textLabel.TextWrapped = true
		textLabel.TextYAlignment = Enum.TextYAlignment.Center
	end
end

local function updateESP()
	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
			local espTag = player.Character:FindFirstChild("ESPName")
			if getgenv().ESPAtivado then
				if not espTag then
					createESP(player)
				else
					local textLabel = espTag:FindFirstChildOfClass("TextLabel")
					if textLabel then
						textLabel.TextColor3 = (player.Team ~= LocalPlayer.Team) and Color3.fromRGB(255,0,0) or Color3.fromRGB(0,0,255)
					end
				end
			elseif espTag then
				espTag:Destroy()
			end
		end
	end
end

-- Atualiza ESP a cada 1 segundo
RunService.Heartbeat:Connect(function()
	if getgenv().ESPAtivado then
		updateESP()
	end
end)

Players.PlayerAdded:Connect(function(player)
	player.CharacterAdded:Connect(function()
		wait(1)
		if getgenv().ESPAtivado then
			updateESP()
		end
	end)
end)

-- Aimbot função de mira no head com checks
local function isAlive(player)
	local char = player.Character
	if not char then return false end
	local humanoid = char:FindFirstChildOfClass("Humanoid")
	return humanoid and humanoid.Health > 0
end

local function isVisible(target)
	if not getgenv().WallCheck then return true end
	local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	local head = target.Character and target.Character:FindFirstChild("Head")
	if not root or not head then return false end

	local ray = Ray.new(root.Position, (head.Position - root.Position).Unit * 500)
	local ignoreList = {LocalPlayer.Character}
	local hitPart, _ = Workspace:FindPartOnRayWithIgnoreList(ray, ignoreList)
	return hitPart == nil or hitPart:IsDescendantOf(target.Character)
end

local function getClosestTarget()
	local closestPlayer = nil
	local shortestDistance = math.huge
	local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	if not root then return nil end

	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
			if getgenv().TeamCheck and player.Team == LocalPlayer.Team then
				-- Ignora time se team check ligado
			else
				if getgenv().DeadCheck and not isAlive(player) then
					-- Ignora mortos
				else
					if isVisible(player) then
						local dist = (player.Character.Head.Position - root.Position).Magnitude
						if dist < shortestDistance then
							shortestDistance = dist
							closestPlayer = player
						end
					end
				end
			end
		end
	end

	return closestPlayer
end

-- Aimbot loop
RunService.RenderStepped:Connect(function()
	if getgenv().AimbotAtivado and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
		local target = getClosestTarget()
		if target and target.Character and target.Character:FindFirstChild("Head") then
			local headPos = target.Character.Head.Position
			Camera.CFrame = CFrame.new(Camera.CFrame.Position, headPos)
		end
	end
end)

-- Aba Auto Win
local AutoWin = Window:CreateTab("Auto Win", 4483362458)

AutoWin:CreateButton({
	Name = "Auto Win Glass Bridge",
	Callback = function()
		Rayfield:Notify({Title = "Aguarde", Content = "Wait 3 seconds", Duration = 3})
		teleportTo(Vector3.new(-22, 161, 1546))
		wait(3)
		teleportTo(Vector3.new(195, 161, 1548))
	end
})

AutoWin:CreateButton({
	Name = "Auto Win Red Light and Green Light",
	Callback = function()
		Rayfield:Notify({Title = "Aguarde", Content = "Wait 4 seconds", Duration = 4})
		teleportTo(Vector3.new(338, 4, -189))
		wait(4)
		teleportTo(Vector3.new(-249, 4, -184))
	end
})

AutoWin:CreateButton({
	Name = "Safezone",
	Callback = function()
		teleportTo(Vector3.new(383, 4, -80))
	end
})

-- Aba Aimbot
local AimbotTab = Window:CreateTab("Aimbot", 4483362458)

AimbotTab:CreateToggle({
	Name = "On aimbot",
	CurrentValue = false,
	Callback = function(Value)
		getgenv().AimbotAtivado = Value
	end
})

AimbotTab:CreateToggle({
	Name = "ESP Enemy",
	CurrentValue = false,
	Callback = function(Value)
		getgenv().ESPAtivado = Value
		if not Value then removeAllESP() end
	end
})

AimbotTab:CreateToggle({
	Name = "Team Check",
	CurrentValue = false,
	Callback = function(Value)
		getgenv().TeamCheck = Value
	end
})

AimbotTab:CreateToggle({
	Name = "Dead Check",
	CurrentValue = false,
	Callback = function(Value)
		getgenv().DeadCheck = Value
	end
})

AimbotTab:CreateToggle({
	Name = "Wall Check",
	CurrentValue = false,
	Callback = function(Value)
		getgenv().WallCheck = Value
	end
})

-- Aba Modifiers
local Modifiers = Window:CreateTab("Modifiers", 4483362458)

Modifiers:CreateSlider({
	Name = "WalkSpeed",
	Range = {16, 300},
	Increment = 1,
	CurrentValue = 16,
	Callback = function(Value)
		local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
		if humanoid then
			humanoid.WalkSpeed = Value
		end
	end
})

Modifiers:CreateSlider({
	Name = "JumpPower",
	Range = {50, 500},
	Increment = 1,
	CurrentValue = 50,
	Callback = function(Value)
		local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
		if humanoid then
			humanoid.JumpPower = Value
		end
	end
})

Modifiers:CreateToggle({
	Name = "Noclip",
	CurrentValue = false,
	Callback = function(Value)
		getgenv().NoclipAtivado = Value
	end
})

Modifiers:CreateToggle({
	Name = "Inf Jump",
	CurrentValue = false,
	Callback = function(Value)
		getgenv().InfJumpAtivado = Value
	end
})

-- Inf Jump implementation
UserInputService.JumpRequest:Connect(function()
	if getgenv().InfJumpAtivado then
		local char = LocalPlayer.Character
		if char and char:FindFirstChildOfClass("Humanoid") then
			char:FindFirstChildOfClass("Humanoid"):ChangeState(Enum.HumanoidStateType.Jumping)
		end
	end
end)

-- Noclip implementation
RunService.Stepped:Connect(function()
	if getgenv().NoclipAtivado and LocalPlayer.Character then
		for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
			if part:IsA("BasePart") then
				part.CanCollide = false
			end
		end
	end
end)

-- Créditos
local Creditos = Window:CreateTab("Credits", 4483362458)
Creditos:CreateParagraph({Title = "Direitor", Content = "@shadown_gd"})
Creditos:CreateParagraph({Title = "Programador", Content = "@shadown_gd and @Shadownchavoso"})
Creditos:CreateButton({
	Name = "DISCORD",
	Callback = function()
		setclipboard("https://discord.gg/baSasGFhaG")
		Rayfield:Notify({Title = "Copiado!", Content = "Link copiado para a área de transferência", Duration = 3})
	end
})
